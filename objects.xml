<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
    <ModulePrefs title="State Example" height="120">
        <Require feature="wave" /> 
    </ModulePrefs>
    <Content type="html">
        <![CDATA[ 
        <div id="content_div" style="height: 50px;"></div>
        <script type="text/javascript">

        var div = document.getElementById('content_div');

        function buttonClicked() {
          var value = wave.getState().get('cunt') ||  "{a: 0}";
          alert(value);
          //value = eval("(" + value + ")");
          //value = value.a+1;
          //wave.getState().submitDelta({'cunt': {a:value}});
          //alert(wave.getState().toString());
        }

        function stateUpdated() {
          alert(wave.getState().get('cunt').toString());
          state = wave.getState().get('cunt');
          state = eval("(" + state + ")");
          if(!(state || state.a)) {
            div.innerHTML = "The cunt is 0."
          }
          else {
            
            div.innerHTML = "The cunt is " state.a;
          } 
        }

        function init() {
          if (wave && wave.isInWaveContainer()) {
            wave.setStateCallback(stateUpdated);
          }
        }
        gadgets.util.registerOnLoadHandler(init);

        // Reset value of "cunt" to 0
        function resetcunter(){
          wave.getState().submitDelta({'cunt': {a: 0}});
        }

        </script>
        <input type=button value="Click Me!" id="butcunt" onClick="buttonClicked()">
        <input type=button value="Reset" id="butReset" onClick="resetcunter()">
        ]]> 
    </Content>
</Module>