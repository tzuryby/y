<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
    <ModulePrefs title="State Example" height="120">
        <Require feature="wave" /> 
    </ModulePrefs>
    <Content type="html">
        <![CDATA[ 
        <div id="content_div" style="height: 50px;"></div>
        <script type="text/javascript">

        var div = document.getElementById('content_div');

        function buttonClicked() {
          var value = parseInt(wave.getState().get('count', {a:1}));
          value[Date()] = Date()
          
          wave.getState().submitDelta({'count': value});
        }

        function stateUpdated() {
          var t = wave.getState().get('count');
          div.innerHTML = wave.printJson(t);
        }

        function init() {
          if (wave && wave.isInWaveContainer()) {
            wave.setStateCallback(stateUpdated);
          }
        }
        gadgets.util.registerOnLoadHandler(init);

        // Reset value of "count" to 0
        function resetCounter(){
          wave.getState().submitDelta({'count': {a:1}});
        }

        </script>
        <input type=button value="Click Me!" id="butCount" onClick="buttonClicked()">
        <input type=button value="Reset" id="butReset" onClick="resetCounter()">
        ]]>  
    </Content>
</Module>