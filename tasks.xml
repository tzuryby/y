<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
    <ModulePrefs title="Simple Tasks List" height="120">
        <Require feature="wave" /> 
    </ModulePrefs>
    <Content type="html">
        <![CDATA[
            <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>            
            <script src="http://github.com/tzuryby/y/raw/master/tasks.xml.js" type="text/javascript"></script>            
            <script type="text/javascript">
var tasklist = window.tasklist = {};

tasklist.newId = function () { 
    lastId = wave.getState().get('lastTaskId', 0);
    return lastId+1;
};

tasklist.Task = function() { return {'title': '', 'done': 0, 'id': tasklist.newId()}; };
tasklist.Tasklist = function(){ return wave.getState().get('taskList', {});};

tasklist.addNew = function (newTask){ 
    alert("addNewCalled");
    list = tasklist.TaskList();
    list[newTask.taskId] = newTask;
    wave.getState().submitDelta({'taskList': list});    
};

tasklist.Delete = function (taskId) { 
    alert("DeleteCalled");
    list = tasklist.TaskList()
    delete tasklist.TaskList()[taskId];
    wave.getState().submitDelta({'taskList': list});
};

tasklist.RenderList = function(){ 
    alert("RenderCalled");
    $.each(tasklist.Tasklist(), function(k,v){
        var newNode = $(
            "<div class='task'>" 
            + v.title 
            + "</div>"
        );
        $("#taskList").append(newNode);
    });
};
            
                /*  wave initialisation and registration  */
                gadgets.util.registerOnLoadHandler(window.tasklist.init);

            </script>
            <div id="taskList"></div>
            <hr />
            <div class=newTask">
                <h3>Add New Task</h3>
                <input type="text" id="newTaskTitle" value="type here" /> <a href="#" id="addNewLink" onClick="addNewTaskHandler()">Add</a>
            </div>
        ]]> 
    </Content>
</Module>